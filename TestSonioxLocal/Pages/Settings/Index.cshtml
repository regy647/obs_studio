@page
@model TestSonioxLocal.Pages.Settings.IndexModel

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>OBS Display Settings</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
            margin: 0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .setting-group { 
            margin: 25px 0; 
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .setting-group h3 {
            margin-top: 0;
            color: #555;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        label { 
            display: block; 
            margin: 10px 0 5px 0;
            font-weight: bold;
            color: #333;
        }
        
        input, select { 
            padding: 8px; 
            margin: 5px 0; 
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        input[type="range"] {
            width: 200px;
            margin-right: 10px;
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .range-value {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }
        
        button { 
            padding: 12px 24px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 6px;
            cursor: pointer; 
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .obs-url-section {
            margin-top: 30px;
            padding: 20px;
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 8px;
        }
        
        .obs-url-section h3 {
            margin-top: 0;
            color: #007bff;
        }
        
        #urlInput {
            width: 100%;
            padding: 10px;
            border: 1px solid #007bff;
            border-radius: 4px;
            font-family: monospace;
            background: white;
            margin: 10px 0;
        }
        
        .copy-btn {
            background: #28a745;
            margin-left: 10px;
        }
        
        .copy-btn:hover {
            background: #1e7e34;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
            display: none;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® OBS Display Settings</h1>
        <div class="obs-url-section" style="background: #e8f4fd; border: 2px solid #007bff; border-radius: 10px; padding: 25px; margin: 30px 0; text-align: center;">
            <h3 style="color: #007bff; margin-top: 0; font-size: 24px;">üîó OBS Browser Source URL</h3>
            <p style="font-size: 18px; margin: 15px 0; color: #333;"><strong>Step 1:</strong> Copy this URL and paste it into your OBS Browser Source:</p>
            <div style="display: flex; gap: 10px; justify-content: center; align-items: center; margin: 20px 0;">
                <input type="text" id="urlInput" value="https://localhost:50001/api/display" readonly style="flex: 1; max-width: 400px; padding: 12px; font-size: 16px; border: 2px solid #007bff; border-radius: 5px;">
                <button onclick="copyUrl()" class="copy-btn" style="padding: 12px 20px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">üìã Copy URL</button>
            </div>
            <p style="color: #666; font-style: italic;"><strong>Step 2:</strong> Configure your settings below, then refresh your OBS Browser Source to see the changes.</p>
        </div>
        
        
        <form id="settingsForm">
            <div class="setting-group">
                <h3>üåç Translation Settings</h3>
                
                <div style="display: flex; gap: 20px; margin: 15px 0;">
                    <div style="flex: 1;">
                        <label for="sourceLanguage">From Language:</label>
                        <select id="sourceLanguage" name="sourceLanguage" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="sl" selected>Slovenian</option>
                            <option value="en">English</option>
                            <option value="de">German</option>
                            <option value="fr">French</option>
                            <option value="es">Spanish</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="ru">Russian</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                            <option value="ar">Arabic</option>
                            <option value="hi">Hindi</option>
                            <option value="nl">Dutch</option>
                            <option value="sv">Swedish</option>
                            <option value="no">Norwegian</option>
                            <option value="da">Danish</option>
                            <option value="fi">Finnish</option>
                            <option value="pl">Polish</option>
                            <option value="cs">Czech</option>
                            <option value="sk">Slovak</option>
                            <option value="hu">Hungarian</option>
                            <option value="ro">Romanian</option>
                            <option value="bg">Bulgarian</option>
                            <option value="hr">Croatian</option>
                            <option value="sr">Serbian</option>
                            <option value="bs">Bosnian</option>
                            <option value="mk">Macedonian</option>
                            <option value="sq">Albanian</option>
                            <option value="el">Greek</option>
                            <option value="tr">Turkish</option>
                            <option value="uk">Ukrainian</option>
                            <option value="be">Belarusian</option>
                            <option value="et">Estonian</option>
                            <option value="lv">Latvian</option>
                            <option value="lt">Lithuanian</option>
                            <option value="ca">Catalan</option>
                            <option value="eu">Basque</option>
                            <option value="gl">Galician</option>
                            <option value="cy">Welsh</option>
                            <option value="ga">Irish</option>
                            <option value="mt">Maltese</option>
                            <option value="is">Icelandic</option>
                            <option value="fo">Faroese</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label for="targetLanguage">To Language:</label>
                        <select id="targetLanguage" name="targetLanguage" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="sl">Slovenian</option>
                            <option value="en" selected>English</option>
                            <option value="de">German</option>
                            <option value="fr">French</option>
                            <option value="es">Spanish</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="ru">Russian</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                            <option value="ar">Arabic</option>
                            <option value="hi">Hindi</option>
                            <option value="nl">Dutch</option>
                            <option value="sv">Swedish</option>
                            <option value="no">Norwegian</option>
                            <option value="da">Danish</option>
                            <option value="fi">Finnish</option>
                            <option value="pl">Polish</option>
                            <option value="cs">Czech</option>
                            <option value="sk">Slovak</option>
                            <option value="hu">Hungarian</option>
                            <option value="ro">Romanian</option>
                            <option value="bg">Bulgarian</option>
                            <option value="hr">Croatian</option>
                            <option value="sr">Serbian</option>
                            <option value="bs">Bosnian</option>
                            <option value="mk">Macedonian</option>
                            <option value="sq">Albanian</option>
                            <option value="el">Greek</option>
                            <option value="tr">Turkish</option>
                            <option value="uk">Ukrainian</option>
                            <option value="be">Belarusian</option>
                            <option value="et">Estonian</option>
                            <option value="lv">Latvian</option>
                            <option value="lt">Lithuanian</option>
                            <option value="ca">Catalan</option>
                            <option value="eu">Basque</option>
                            <option value="gl">Galician</option>
                            <option value="cy">Welsh</option>
                            <option value="ga">Irish</option>
                            <option value="mt">Maltese</option>
                            <option value="is">Icelandic</option>
                            <option value="fo">Faroese</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 20px; margin: 15px 0;">
                    <div style="flex: 1;">
                        <label for="transcriptionToggle">Show Transcriptions:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="transcriptionToggle" name="transcriptionToggle" checked style="transform: scale(1.2);">
                            <span>Display original speech transcriptions</span>
                        </div>
                    </div>
                    <div style="flex: 1;">
                        <label for="translationToggle">Show Translations:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="translationToggle" name="translationToggle" checked style="transform: scale(1.2);">
                            <span>Display translated text</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="setting-group">
                <h3>üé® Text Appearance</h3>
                
                <label for="textColor">Text Color:</label>
                <input type="color" id="textColor" name="textColor" value="#ffffff">
                
                <label for="textSize">Text Size:</label>
                <div class="range-container">
                    <input type="range" id="textSize" name="textSize" min="12" max="48" value="24">
                    <span class="range-value" id="textSizeValue">24px</span>
                </div>
                
                <label for="lineSpacing">Line Spacing:</label>
                <div class="range-container">
                    <input type="range" id="lineSpacing" name="lineSpacing" min="1.0" max="2.5" step="0.1" value="1.5">
                    <span class="range-value" id="lineSpacingValue">1.5</span>
                </div>
            </div>
            
            <div class="setting-group">
                <h3>üì¶ Container Settings</h3>
                
                <label for="containerColor">Container Background:</label>
                <select id="containerColor" name="containerColor">
                    <option value="rgba(0, 0, 0, 0.7)">Black (70% opacity)</option>
                    <option value="rgba(255, 255, 255, 0.9)">White (90% opacity)</option>
                    <option value="transparent">Transparent</option>
                    <option value="rgba(0, 0, 0, 0.5)">Black (50% opacity)</option>
                    <option value="rgba(0, 0, 0, 0.9)">Black (90% opacity)</option>
                </select>
            </div>
            
            <div class="setting-group">
                <h3>üëÅÔ∏è Visibility Settings</h3>
                
                <label>
                    <input type="checkbox" id="showTranscriptions" name="showTranscriptions" checked> 
                    Show Transcriptions
                </label>
                
                <label>
                    <input type="checkbox" id="showTranslations" name="showTranslations" checked> 
                    Show Translations
                </label>
            </div>
            
            <button type="submit">üíæ Save Settings</button>
            
            <div id="successMessage" class="success-message" style="display: none; background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 15px; border: 1px solid #c3e6cb;">
                ‚úÖ Settings saved successfully! Refresh your OBS Browser Source to see the changes.
            </div>
            
            <div id="errorMessage" class="error-message" style="display: none; background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 15px; border: 1px solid #f5c6cb;">
                ‚ùå Error saving settings. Please try again.
            </div>
        </form>
        
    </div>

    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script>
        // SignalR connection for language updates
        const connection = new signalR.HubConnectionBuilder()
            .withUrl('/caption-hub')
            .build();
        
        // Start connection
        connection.start().then(() => {
            console.log('Connected to hub for language updates');
        }).catch(err => console.error('Hub connection error:', err));
        
        // Update range displays
        document.getElementById('textSize').addEventListener('input', function() {
            document.getElementById('textSizeValue').textContent = this.value + 'px';
        });
        
        document.getElementById('lineSpacing').addEventListener('input', function() {
            document.getElementById('lineSpacingValue').textContent = this.value;
        });

        // Handle form submission
        document.getElementById('settingsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const settings = {
                textColor: formData.get('textColor'),
                textSize: parseInt(formData.get('textSize')),
                lineSpacing: parseFloat(formData.get('lineSpacing')),
                containerColor: formData.get('containerColor'),
                sourceLanguage: formData.get('sourceLanguage'),
                targetLanguage: formData.get('targetLanguage'),
                transcriptionToggle: formData.get('transcriptionToggle') === 'on',
                translationToggle: formData.get('translationToggle') === 'on'
            };
            
            try {
                // First, update language settings through SignalR (same as original system)
                if (settings.sourceLanguage && settings.targetLanguage) {
                    console.log('Updating language settings via SignalR:', settings.sourceLanguage, '‚Üí', settings.targetLanguage);
                    await connection.invoke("UpdateLanguageSettings", settings.sourceLanguage, settings.targetLanguage);
                    console.log('‚úÖ Language settings updated successfully');
                }
                
                // Then save other settings
                const response = await fetch('/api/display/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('errorMessage').style.display = 'none';
                } else {
                    throw new Error('Server error');
                }
            } catch (error) {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
                console.error('Error saving settings:', error);
            }
        });
        
        function copyUrl() {
            const urlInput = document.getElementById('urlInput');
            urlInput.select();
            urlInput.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            
            // Visual feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Copied!';
            button.style.background = '#28a745';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '#28a745';
            }, 2000);
        }
    </script>
</body>
</html>
